/* ===== 1. 主题变量 ===== */
:root {
  /* 边框 */
  --border-light: rgba(0, 0, 0, 0.15);
  --border-dark:  rgba(255,255,255,0.1);
  /* 主色 */
  --primary-light: #1e90ff;
  --primary-dark:  #3b82f6;
  --primary-light-rgb: 30,144,255;
  --primary-dark-rgb:  59,130,246;
  /* 背景 & 文字 */
  --bg-light: #ffffff;
  --bg-dark:  #0f1115;
  --sidebar-light: #f5f6f8;
  --sidebar-dark:  #14171d;
  --text-light: #1f1f1f;
  --text-dark:  #e2e8f0;
  /* 其它 */
  --ui-scale: 1;
}
body.light-theme {
  --border-color: var(--border-light);
  --primary: var(--primary-light);
  --primary-rgb: var(--primary-light-rgb);
  --bg-color: var(--bg-light);
  --sidebar-bg: var(--sidebar-light);
  --text-color: var(--text-light);
}
body.dark-theme {
  --border-color: var(--border-dark);
  --primary: var(--primary-dark);
  --primary-rgb: var(--primary-dark-rgb);
  --bg-color: var(--bg-dark);
  --sidebar-bg: var(--sidebar-dark);
  --text-color: var(--text-dark);
}

/* ===== 2. Reset ===== */
*,*::before,*::after{box-sizing:border-box;}
html,body{margin:0;padding:0;height:100%;overflow:hidden;font-family:'Roboto',sans-serif;background:var(--bg-color);color:var(--text-color);zoom:var(--ui-scale);-webkit-tap-highlight-color:transparent;}
a{color:inherit;text-decoration:none;}
button{font-family:inherit;cursor:pointer;}

/* ===== 3. 布局容器 ===== */
.container{display:flex;height:100%;width:100%;}

/* ===== 4. 侧边栏 ===== */
.sidebar{
  width:240px;
  background:var(--sidebar-bg);
  border-right:1px solid var(--border-color);
  display:flex;flex-direction:column;
}
.logo{font-size:1.4rem;padding:20px;text-align:center;}
.new-btn{
  margin:0 16px 12px;
  padding:10px 0;
  width:auto;
  background:var(--primary);
  color:#fff;
  border:none;border-radius:6px;
  font-size:0.95rem;
}
.new-btn:hover{background:rgba(var(--primary-rgb),0.9);}

.conv-nav{flex:1;overflow-y:auto;margin:0;padding:0;list-style:none;}
.conv-nav li{
  padding:12px 18px;
  border-radius:8px;
  white-space:nowrap;
  text-overflow:ellipsis;
  overflow:hidden;
  position:relative;
  transition:background 0.15s ease;
  margin: 0 16px;
  
}
.conv-nav li:hover{background:rgba(var(--primary-rgb),0.12);}


.sidebar-footer .settings-btn {
  font-size: 1rem;          /* 字体稍大 */
  padding: 0.75em 1em;      /* 内边距加大 */
  min-width: 100px;         /* 最小宽度保证易点 */
  justify-content: center;  /* 如果是 flex 布局，文字居中 */
}
.settings-area {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
}
.setting-item {
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
}
.setting-item label {
  margin-right: auto;   /* 左侧自适应扩展 */
}
.setting-item input,
.setting-item select,
.setting-item button {
  margin-left: 8px;     /* 各控件间留白 */
  flex-shrink: 0;
}


/* ===== 5. 主区 ===== */
.main-area{flex:1;display:flex;flex-direction:column;position:relative;min-width:0;}

/* 5-1 头部 */
.chat-header{
  display:flex;align-items:center;gap:12px;
  padding:12px 16px;
  border-bottom:1px solid var(--border-color);
  background:var(--bg-color);
  min-height:48px;
  flex-shrink:0;
}
.chat-header h1{margin:0;font-size:1.1rem;font-weight:500;}

/* 5-2 聊天内容 */
.chat-area{flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;position: relative;}


/* —— 新增：归档按钮样式 —— */
#archive-current-btn {
  position: absolute !important;
  top: 8px !important;
  /* 让它紧挨删除按钮左侧 — 删除是 right:12px，这里设置一个合适的偏移 */
  right: 80px !important;        /* 你可以根据按钮宽度微调这个值 */
  padding: 6px 12px !important;
  background: #fff !important;
  color: #000 !important;
  border: 1px solid #ccc !important;
  border-radius: 4px !important;
  font-size: 0.9rem !important;
  cursor: pointer !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
  transition: background 0.2s ease, border-color 0.2s ease !important;
}
#archive-current-btn:hover {
  background: #f7f7f7 !important;
  border-color: #bbb !important;
}

.messages {
  flex: 1;
  overflow-y: auto;
  padding: 24px 24px 75px;     /* 原有上下内边距 */
  display: flex;               /* 用 flex 而不是 inline-flex */
  flex-direction: column;
  gap: 14px;
  width: 100%;
  max-width: 100%;
  word-break: break-word;
}
/* 确保用户消息这整个 flex-item 占满全行并靠右 */



/* ✅ 消息通用容器结构（无重复 padding） */
.message {
  max-width: 65%;
  margin: 6px 0;
  padding: 8px 12px;
  border-radius: 16px;
  line-height: 1.5;
  font-size: 0.95rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  word-break: break-word;
}

/* ✅ 用户气泡：右对齐 + 蓝色背景 */
.message.user {
  align-self: flex-end;
  display: inline-block !important;
  background-color: var(--primary); /* 来自主题变量 */
  color: white;
  margin-right: 16px;
  margin-left: auto;
  text-align: left;
  margin: 0
}
.message .text {
  
  word-break: break-word;
  overflow-wrap: break-word;
}

.message.assistant {
  /* 水平自适应、左对齐不变 */
  display: inline-block;
  width: auto;
  max-width: 65%;
  min-width: 96px;

  margin: 6px 0 6px 16px;
  
  /* 上下内边距缩成 4px，让单行文字高度和用户气泡一致 */
  padding: 8px 12px;
  
  border-radius: 16px;
  background-color: rgba(255,255,255,0.06);
  color: var(--text-color);
  word-break: break-word;
  text-align: left;
}


/* ✅ 清理内层 text 元素样式，避免重复边距撑开 */
.message .text {
  margin: 0 !important;
  padding: 0 !important;
  background: none !important;
  border: none !important;
  box-shadow: none !important;

}

/* 只清除用户气泡内的 <p> 上下 margin */
.message.user .text p {
  margin-top:    0 !important;
  margin-bottom: 0 !important;
}

/* 5-2-1 浅色气泡 */
body.light-theme .message.assistant{
  align-self:flex-start;
  background:#f0f2f5;
  color:var(--text-color);
  border:1px solid rgba(0,0,0,0.06);
}
body.light-theme .message.user{
  align-self:flex-end;
  background:var(--primary);
  color:#fff;
}

/* 5-2-2 深色气泡 */
body.dark-theme .message.assistant{
  align-self:flex-start;
  background:rgba(255,255,255,0.06);
  color:var(--text-color);
  border:1px solid rgba(255,255,255,0.08);
}
body.dark-theme .message.user{
  align-self:flex-end;
  background:var(--primary);
  color:#fff;
}

.message pre,.message code{font-family:monospace;}
.message pre{background:rgba(0,0,0,0.15);padding:8px;border-radius:6px;overflow-x:auto;}

.input-area {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 20px 20px 8px;   
  background: var(--bg-color);
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 16px;
  align-items: center;
  z-index: 10;
}

.input-area textarea {
  height: 50px;
  padding: 6px;
  min-height: 50px;
  font-size: 0.95rem;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: var(--bg-color);
  color: var(--text-color);
  resize: vertical;
  flex: 1;
  /* 高度控制重点在这里 ↓↓↓ */
  
  max-height: 200px;        /* 防止撑太高 */
  line-height: 1.6;
  resize: vertical;         /* 允许手动拉高 */
  overflow-y: auto;         /* 内容多时出现滚动条 */
}

.input-area button{
  padding:10px 22px;
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:0.95rem;
  flex:0 0 auto;
}

.input-area button:hover{
  background:rgba(var(--primary-rgb),0.9);
}

/* 模型切换下拉靠左，保持层级 */
.model-select select{z-index:1000;background:var(--bg-color);color:var(--text-color);border:1px solid var(--border-color);border-radius:6px;padding:6px;}

/* ===== 7. 危险按钮 ===== */
button.danger,#delete-current-btn{background:#e53e3e!important;color:#fff!important;}
button.danger:hover,#delete-current-btn:hover{background:#c53030!important;}

/* ===== 8. 滚动条美化 ===== */
.messages::-webkit-scrollbar{width:8px;}
.messages::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.25);border-radius:4px;}
.sidebar::-webkit-scrollbar{width:6px;}
.sidebar::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.2);border-radius:4px;}

/* ===== 9. 响应式 ===== */
@media(max-width:768px){
  .sidebar{display:none;}
  .container{flex-direction:column;}
  .chat-header{padding:10px;}
  .new-btn{margin:12px;}
}

/* ===== 10. Helper 类 ===== */
.hide{display:none!important;}
.full-width{width:100%!important;}
.text-center{text-align:center!important;}

/* —— 补丁开始 —— */

/* 1. 美化侧栏“设置”⚙ 按钮 */
.settings-btn {
  display: block;                       /* 从 inline-flex 改为块级 */
  margin: 0 20px 15px;                  /* 同侧边栏按钮左右间距 */
  width: calc(100% - 40px);             /* 扣除左右各 20px 外边距后撑满宽度 */
  height: 48px;                         /* 固定高度，可按需调整 */
  padding: 0 16px;                      /* 左右 padding 保证文字有呼吸感 */
  background: #10a37f;
  color: #fff;
  font-weight: 500;
  border: none;
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  text-align: center;                   /* 文字水平居中 */
  line-height: center;                    /* 文字垂直居中 */
}
.settings-btn:hover {
  filter: brightness(0.9);
}

.settings-btn:hover {
  filter: brightness(0.9);
}

/* 2. 侧栏选中项和按钮同宽（修正版） */
.new-btn {
  margin: 0 20px 15px;      /* 与列表项左右一致 */
}

/* 先清除所有默认列表缩进 */
.conv-nav ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

/* 列表项统一 */
.conv-nav li {
  display: block;
  margin: 0 20px 5px;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
}

/* hover 高亮 */
.conv-nav li:hover {
  background: rgba(var(--primary-rgb), 0.12);
}



/* 通用：清除原生样式，统一排版 */
.input-area select#model {
  appearance: none;
  -webkit-appearance: none;
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  padding: 6px 32px 6px 12px;
  border-radius: 4px;
  background-repeat: no-repeat;
  background-position: right 8px center;
  transition: border-color .2s, box-shadow .2s;
}

/* 箭头图标（Data URI SVG）*/
.input-area select#model {
  background-image: url("data:image/svg+xml;charset=UTF-8,<svg width='10' height='6' viewBox='0 0 10 6' xmlns='http://www.w3.org/2000/svg'><path d='M0 0l5 6 5-6z' fill='%23999'/></svg>");
}

/* —— 浅色主题 —— */
body.light-theme .input-area select#model {
  background-color: #fff;
  color: #333;
  border: 1px solid #ccc;
}
body.light-theme .input-area select#model:focus {
  outline: none;
  border-color: #40a9ff;
  box-shadow: 0 0 0 2px rgba(24,144,255,0.2);
}
body.light-theme .input-area select#model option {
  background: #fff;
  color: #333;
}
body.light-theme .input-area select#model option:hover {
  background-color: #f5f5f5;
}

/* —— 深色主题 —— */
body.dark-theme .input-area select#model {
  background-color: #2e2f3a;
  color: #ececf1;
  border: 1px solid #555;
}
body.dark-theme .input-area select#model:focus {
  outline: none;
  border-color: #409cff;
  box-shadow: 0 0 0 2px rgba(64,156,255,0.2);
}
body.dark-theme .input-area select#model option {
  background: #2e2f3a;
  color: #ececf1;
}
body.dark-theme .input-area select#model option:hover {
  background-color: #3a3b45;
}


/* 3. 优化模型选择下拉样式 */
.input-area select#model {
  /* ...前面那些 appearance、padding 等不变... */

  /* 把箭头图标放到正确的 selector 里 */
  background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdo dD0iOCIgdmlld0JveD0iMCAwIDEyIDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAw L3N2ZyI+PHBvbHlnb24gcG9pbnRzPSIwIDAgNiA4IDEyIDAgMCAwIiBmaWxsPSIjY2NjIi8+ PC9zdmc+");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 12px 8px;
}


/* 4. 设置界面排版调整 */
.settings-area {
  padding: 24px 32px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}
.settings-area h2 {
  font-size: 1.6rem;
  margin-bottom: 16px;
  font-weight: 600;
}
.setting-item {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}
.setting-item label {
  flex: 0 0 200px;             /* 固定标签宽度 */
  font-weight: 500;
}
.setting-item input[type="password"],
.setting-item select {
  flex: 1;
  min-width: 200px;
}
.setting-item button {
  flex: 0 0 auto;
  padding: 8px 20px;
  font-size: 0.95rem;
  border-radius: 6px;
}

/* 5. 精简输入区按钮和下拉整体对齐 */
.input-area {
  padding: 8px 20px;           /* 减少上下内边距 */
}
.input-area button {
  padding: 8px 24px;
  font-size: 0.95rem;
  border-radius: 6px;
}

/* —— 补丁结束 —— */

/* ===== 覆盖：删除按钮样式 ===== */
#delete-current-btn {
  position: absolute !important;
  top: 8px !important;
  right: 12px !important;
  padding: 6px 12px !important;
  background: #e53e3e !important;
  color: #fff !important;
  border: none !important;
  border-radius: 4px !important;
  font-size: 0.9rem !important;
  cursor: pointer !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
  transition: background 0.2s ease !important;
}
#delete-current-btn:hover {
  background: #c53030 !important;
}

/* 清除助手机泡内 <p> 的默认 margin */
.message .text p {
  margin: 0;
}
/* 隐藏所有空的 <p> */
.message .text p:empty {
  display: none !important;
}

body.light-theme ::-webkit-scrollbar {
  width: 8px;
}
body.light-theme ::-webkit-scrollbar-track {
  background: #f0f0f0;
  border-radius: 4px;
}
body.light-theme ::-webkit-scrollbar-thumb {
  background-color: #c0c0c0;
  border-radius: 4px;
  border: 2px solid #f0f0f0;
}
body.light-theme ::-webkit-scrollbar-thumb:hover {
  background-color: #999;
}
body.light-theme {
  scrollbar-color: #bbb #f0f0f0;
  scrollbar-width: thin;
}

body.dark-theme ::-webkit-scrollbar {
  width: 8px;
}
body.dark-theme ::-webkit-scrollbar-track {
  background: #1f1f1f;
  border-radius: 4px;
}
body.dark-theme ::-webkit-scrollbar-thumb {
  background-color: #444;
  border-radius: 4px;
  border: 2px solid #1f1f1f;
}
body.dark-theme ::-webkit-scrollbar-thumb:hover {
  background-color: #666;
}
body.dark-theme {
  scrollbar-color: #444 #1f1f1f;
  scrollbar-width: thin;
}

/* 用户气泡保留换行 */
.message.user .text {
  white-space: pre-wrap !important;
}
/* loading 占位样式 */
.message.assistant.loading {
  opacity: 0.6;
  font-style: italic;
}

/* 清除助手机泡内 <p> 的默认 margin */
.message .text p {
  margin: 0;
}
/* 隐藏所有真正空的 p（以防万一） */
.message .text p:empty {
  display: none !important;
}

/* 聊天框中所有链接显示为蓝色，并加下划线 */
.message .text a {
  color: #0066cc !important;
  text-decoration: underline !important;
}

/* 鼠标移上去时加深一下色 */
.message .text a:hover {
  color: #004999 !important;
}

/* 聊天消息中的图片自适应宽度、保持纵横比 */
.message .text img {
  display: block;             /* 单独一行，自动撑开容器 */
  max-width: 100% !important; /* 最宽不超过气泡宽度 */
  height: auto !important;    /* 高度按比例自适应 */
  margin: 8px 0;              /* 上下加点间距 */
  border-radius: 4px;         /* 圆润点儿，可选 */
}

#edit-title-btn {
  font-size: 0.9em;
  vertical-align: middle;
}
#edit-title-btn:hover {
  opacity: 0.7;
}

/* —— 美化对话标题编辑框 —— */
#chat-title-input {
  background-color: rgba(255,255,255,0.05); /* 轻微透明黑 */
  border: 1px solid #555;                  /* 中灰边框 */
  border-radius: 4px;                      /* 圆角 */
  padding: 4px 8px;                        /* 内边距 */
  color: #fff;                             /* 白色字体 */
  font-weight: 550;                        /* 稍粗 */
  font-family: inherit;                    /* 继承节奏 */
  outline: none;                           /* 去掉默认 outline */
  min-width: 120px;                        /* 最小宽度 */
}

/* 焦点时高亮边框 */
#chat-title-input:focus {
  border-color: #3399ff;
  box-shadow: 0 0 4px rgba(51,153,255,0.6);
}
/* 针对两种主题分别优化编辑框可见性 */
body.light-theme #chat-title-input {
  /* 浅色主题下用深色半透明底、深灰边框 */
  background-color: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.2);
  color: var(--text-light);
}

body.dark-theme #chat-title-input {
  /* 深色主题下用亮色半透明底、中灰边框 */
  background-color: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: var(--text-dark);
}

/* 容器保持 inline-flex，让按钮靠右显示 */
.scale-frame {
  display: inline-flex;
  margin-left: 8px;
}

/* 按钮组 */
.scale-frame .scale-options {
  display: flex;
}

/* 各按钮：固定宽度、高度，单行文字 */
.scale-frame .scale-options button {
  flex: none;               /* 不等分，使用固定宽度 */
  width: 50px;              /* 根据文字长度调整 */
  padding: 6px 0;           /* 垂直内边距，水平由 width 决定 */
  margin: 0 2px;            /* 每个按钮左右留一点间距 */
  border: 1px solid var(--border-color);
  background: var(--bg-secondary);
  color: var(--text-primary);
  text-align: center;
  font-size: 0.9em;
  line-height: 1;           /* 让文字垂直居中 */
  cursor: pointer;
  border-radius: 4px;       /* 全体一致圆角 */
}

/* 选中态仅改变边框颜色，不要背景高亮 */
.scale-frame .scale-options button.active {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

/* 去掉之前的 hover 背景高亮，仅加个边框反馈 */
.scale-frame .scale-options button:hover {
  border-color: var(--primary-color);
}

/* 把 ghost 隐掉，直接移动原始 li */
.sortable-ghost {
  opacity: 0 !important;
}

/* 被拖住的 li 加个样式提示一下 */
.sortable-chosen {
  background: rgba(var(--primary-rgb), 0.2) !important;
  border: 1px dashed rgba(var(--primary-rgb), 0.5) !important;
}


/* 让所有列表项相对定位，便于 ::before 绝对定位画线 */
#conversation-list li {
  position: relative;        /* 新增：建立定位上下文 */
  display: block;
  margin: 0 20px 5px;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
}

#conversation-list li:hover {
  background: rgba(var(--primary-rgb), 0.12);  /* 自行调整 alpha 值，看着舒服就好 */
  color: inherit;                             /* 保持文字原色 */
}

/* 拖拽时在空位处的元素上画一条蓝色分隔线 */
#conversation-list li.sortable-ghost::before {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 0;           /* 如果想在上方画线，就 top:0 */
  height: 2px;      /* 线的粗细 */
  background: var(--primary-color);
}

.setting-item button {
  min-width: 80px;
}

/* 分隔线 */
.archive-divider {
  text-align: center;
  color: var(--text-secondary);
  font-size: 0.8em;
  margin: 8px 0;
}

/* 已归档项样式 */
.conversation-item.archived .title {
  opacity: 0.6;
}


/* 1. 先把旧版 btn-delete / btn-archive（如果残留）彻底隐藏 */
#conversation-list li .btn-delete,
#conversation-list li .btn-archive {
  display: none !important;
}

/* 2. 针对我们自己插入的 .del 按钮：默认不显示 */
#conversation-list li .del {
  position: absolute;        /* 新增：脱离文档流 */
  right: 16px;               /* 距离右侧 16px */
  top: 50%;                  /* 垂直中心线 */
  transform: translateY(-50%);/* 垂直居中 */
  
  display: none;             /* 默认不显示 */
  opacity: 0;
  visibility: hidden;
  
  background: transparent !important;
  border: none !important;
  color: red !important;
  font-size: 0.9rem !important;
  cursor: pointer !important;
}

#conversation-list li:hover .del {
  display: inline-block !important;
  opacity: 1 !important;
  visibility: visible !important;
}

/* 二级菜单默认收起 */
.archived-list {
  display: none;
  margin-left: 16px;
  padding-left: 0;
  list-style: none;
}

/* 点击“已归档”时展开 */
.archive-toggle.expanded + .archived-list {
  display: block;
}

/* 样式美化 */
.archive-toggle {
  cursor: pointer;
  font-weight: bold;
  padding: 8px 16px;
  user-select: none;
}
.archive-toggle::before {
  content: '▶';
  display: inline-block;
  margin-right: 6px;
  transform: rotate(0deg);
  transition: transform 0.2s;
}
.archive-toggle.expanded::before {
  transform: rotate(90deg);
}

/* —— 活动项高亮 —— */
#conversation-list li.active {
  background: var(--primary) !important;
  color: #fff !important;
}
